<head>
  
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.4/awesomplete.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.4/awesomplete.js" async></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://d3js.org/d3.v5.js"></script>

</head>

<script>
  
  var ajax = new XMLHttpRequest();
ajax.open("GET", "https://exoplanetarchive.ipac.caltech.edu/cgi-bin/nstedAPI/nph-nstedAPI?table=exoplanets&select=distinct%20pl_hostname&format=json", true);
ajax.onload = function() {
	var list = JSON.parse(ajax.responseText).map(function(i) { return i.pl_hostname; });
	new Awesomplete(document.querySelector("#system"),{ list: list });
};
ajax.send();
  
  
  
  
  document.addEventListener('DOMContentLoaded',function(){
    document.getElementById('getMessage').onclick=function(){
      req=new XMLHttpRequest();
      system_input = document.getElementById("system").value;
      url = "https://exoplanetarchive.ipac.caltech.edu/cgi-bin/nstedAPI/nph-nstedAPI?table=exoplanets&select=pl_hostname,pl_radj,pl_name,pl_letter,pl_orbsmax&order=dec&format=json&where=pl_hostname%20like%20%27" + system_input + "%27";
      req.open("GET",url,true);
      req.send();
      req.onload=function(){
        json=JSON.parse(req.responseText);
        var html = "";
        var names = [];
        var dists = [];
        var radii = [];
        var dataset = [];
        // Add your code below this line
        json.forEach(function(val) {
          var keys = Object.keys(val);
          html += "<div class = 'planet'>";
          keys.forEach(function(key) {
            html += "<strong>" + key + "</strong>: " + val[key] + "<br>";
            switch(key) {
              case 'pl_name':
                names.push(val[key])
                break;
              case 'pl_orbsmax':
                dists.push(val[key])
                break;
              case 'pl_radj':
                if (val[key] === null) {
                  radii.push(0.15)
                } else {
                  radii.push(val[key])
                }

                break;

              default:
                // code block
            }
           


          });
          html += "</div><br>";

         });
          var i;
          for (i = 0; i < names.length; i++) {
               dataset.push([dists[i], 250, names[i], radii[i]])

          }

        
        // Add your code above this line
        d3.select(".info").html(html);
        const w = 1000;
        const h = 500;
        const padding = 60;
    
        const xScale = d3.scaleLinear()
                     .domain([0, d3.max(dataset, (d) => d[0])])
                     .range([padding, w - padding]);
    
        const yScale = d3.scaleLinear()
                     .domain([0, d3.max(dataset, (d) => d[1])])
                     .range([h - padding, padding]);
        
        d3.select(".graph").select("svg").remove();
        
        const svg = d3.select(".graph")
                  .append("svg")
                  .attr("width", w)
                  .attr("height", h);
        
            svg.append("text")
                .attr("x", w / 2 )
                .attr("y", 20)
                .attr("class","whitetext")
                .style("text-anchor", "middle")
                .text(system_input);
        
           svg.append("text")
                .attr("x", w / 2 )
                .attr("y", h - 20)
                .attr("class","whitetext")
                .style("text-anchor", "middle")
                .text("Distance from " + system_input + " in AU (1 AU = Earth-Sun distance)");

        svg.selectAll("circle")
           .data(dataset)
           .enter()
           .append("circle")
           .attr("cx", (d) => xScale(d[0]))
           .attr("cy",(d) => (d[1]))
           .attr("r", (d) => 50 * d[3])
           .append("svg:title")
           .text(function(d) { if(d[3] != 0.15) {return d[2] + ': radius of ' + d[3] + ' Jupiter radii and ' + d[0] + 'AU from ' + system_input; } else {
          return d[2] + ': unknown radius and ' + d[0] + 'AU from ' + system_input;
        }});



        const xAxis = d3.axisBottom(xScale);
        // Add your code below this line
        const yAxis = undefined;
        // Add your code above this line

        svg.append("g")
           .attr("transform", "translate(0," + (h - padding) + ")")
        .attr("class","axisWhite")
           .call(xAxis);
      };
    };
  });
  

</script>
<style>
  svg {
    background: black;
  }
  
  .whitetext{
    fill:white
  } 
  circle {
    fill:white;
  }
.axisWhite line{
  stroke: white;
}

.axisWhite path{
  stroke: white;
}

.axisWhite text{
  fill: white;
}  
  
  input[type="text"] {
    font-size:2em;
}

  
  body {
    text-align: center;
    font-family: "Helvetica", sans-serif;
  }
  h1 {
    font-size: 2em;
    font-weight: bold;
  }
  .box {
    border-radius: 5px;
    background-color: #eee;
    padding: 20px 5px;
  }
  button {
    color: white;
    background-color: #4791d0;
    border-radius: 5px;
    border: 1px solid #4791d0;
    padding: 5px 10px 8px 10px;
  }
  button:hover {
    background-color: #0F5897;
    border: 1px solid #0F5897;
  }
</style>
<h1>Exo-System Planet Viewer</h1> 
<p>Early Prototype, limited functionality. Tested with Kepler-296, HD 10180 & HD 39091</p>
<p>Any of <a href="https://exoplanetarchive.ipac.caltech.edu/cgi-bin/nstedAPI/nph-nstedAPI?table=exoplanets&select=distinct%20pl_hostname&format=json">the host stars listed here</a> should work.</p>  The pre-filled value (KOI-351) is <a href="https://en.wikipedia.org/wiki/Kepler-90">Kepler-90</a>, <a href="https://en.wikipedia.org/wiki/TRAPPIST-1">TRAPPIST-1</a> is also well known.
<p>All planets with unknown radii shown as 0.15 Jupiter Radii (no reason for this number)</p>
<input class="awesomplete" type="text" id="system" value="KOI-351">
<!--<p class="message box">
  Waiting for Data
</p>-->
<p>
  <button id="getMessage">
    Visualise!
  </button>
</p>

<div class='graph'>
  
</div>

<div class='info'>
  
</div>

<p>Data comes from <a href="https://exoplanetarchive.ipac.caltech.edu/">The NASA Exoplanet Archive</a></p> <p>Code developed from the D3 tutorials at the excellent <a href="https://www.freecodecamp.com">freeCodeCamp</a> using <a href="https://codepen.io/dhjc/pen/BMjbbV">CodePen</a></p>
<p>Created by Dominic Cave (<a href="https://www.dhjc.uk">website<a>, <a href="https://www.github.com/dhjc">github</a>)
